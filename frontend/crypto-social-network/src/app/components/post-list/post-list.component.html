<div class="container mx-auto p-4 border-b-2 border-gray-200 max-w-screen-lg">
    <h2 class="text-2xl font-bold mb-4">Create a new post</h2>
    <textarea [(ngModel)]="newPostContent"
        class="w-full p-4 border rounded-lg shadow focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4"
        placeholder="What's on your mind?"></textarea>
    <div class="flex justify-end mt-2">
        <button (click)="createPost()"
            class="px-4 py-2 bg-blue-500 text-white rounded-lg shadow hover:bg-blue-600">Publish Post</button>
        <button (click)="newPostContent = ''"
            class="ml-2 px-4 py-2 bg-gray-300 text-black rounded-lg shadow hover:bg-gray-400">Cancel</button>
    </div>
</div>

<div class="container mx-auto p-4 border-b-2 border-gray-200 max-w-screen-lg">
    <h2 class="text-2xl font-bold mb-4">Posts</h2>
    <div class="mb-4 flex items-center">
        <label for="sort-by" class="mr-2 font-semibold">Sort by:</label>
        <select id="sort-by" [(ngModel)]="sortBy" (change)="changeSort(sortBy)"
            class="ml-2 border rounded-2xl p-2 shadow focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="date">By date</option>
            <option value="hot">Hot</option>
        </select>
    </div>
</div>

<div *ngFor="let post of posts | paginate: { itemsPerPage: 5, currentPage: p }"
    class="p-6 border rounded-3xl mb-8 bg-white shadow-lg">
    <div class="flex items-center mb-2">
        <span class="font-bold text-xl">
            {{ post.user ? post.user.username : 'Deleted User' }}
        </span>
    </div>
    <p class="text-gray-800 break-words mb-2">{{ post.content }}</p>
    <p class="text-gray-600 text-sm mb-2">Created at: {{ post.createdAt | date:'short' }}</p>
    <div class="mt-2 flex items-center">
        <button (click)="upvotePost(post._id)" class="flex items-center text-gray-500 mr-4 hover:text-blue-500">
            <i class="bi bi-arrow-up mr-1"></i>
            <span>{{ post.upvotes }}</span>
        </button>
        <button (click)="downvotePost(post._id)" class="flex items-center text-gray-500 hover:text-red-500">
            <i class="bi bi-arrow-down mr-1"></i>
            <span>{{ post.downvotes }}</span>
        </button>
        <button *ngIf="post.user && post.user._id === userService.getUserIdFromToken()" (click)="editPost(post._id)"
            class="flex items-center text-blue-500 ml-2 hover:text-blue-600">
            <i class="bi bi-pencil mr-1"></i> Edit
        </button>
        <button *ngIf="authService.isAdmin() || (post.user && post.user._id === userService.getUserIdFromToken())"
            (click)="deletePost(post._id)" class="flex items-center text-red-500 ml-2 hover:text-red-600">
            <i class="bi bi-trash mr-1"></i> Delete
        </button>
    </div>
    <app-comment-list [postId]="post._id"></app-comment-list>
</div>


<div class="pagination-container mt-4 max-w-screen-lg mx-auto">
    <pagination-controls (pageChange)="p = $event"></pagination-controls>
</div>