<div class="container mx-auto p-4 border-b-2 border-gray-200">
    <h1 class="text-4xl font-bold mb-4">Submit new Polls</h1>
    <div *ngFor="let poll of polls" class="mb-4 p-4 border rounded-lg shadow-lg">
        <div class="mb-2">
            <h3 class="text-xl font-semibold">{{ poll.title }}</h3>
            <small class="text-gray-500">Created at: {{ poll.createdAt | date:'short' }}</small>
        </div>

        <div *ngIf="!poll.showQuestions">
            <a class="text-blue-500 underline cursor-pointer" (click)="toggleQuestions(poll)">See more...</a>
        </div>

        <div *ngIf="poll.showQuestions">
            <div *ngFor="let question of poll.questions; let qIndex = index" class="mb-4">
                <div class="mb-2">
                    <h4 class="text-lg font-semibold">{{ question.question }}</h4>
                </div>
                <div *ngFor="let option of question.options; let oIndex = index" class="my-2">
                    <input class="mr-2" type="radio" [name]="'option' + poll._id + qIndex" [value]="oIndex"
                        [(ngModel)]="selectedOptions[poll._id][qIndex]" />
                    <label class="font-medium">
                        {{ option }}
                    </label>
                </div>
            </div>
            <a class="text-blue-500 underline cursor-pointer" (click)="toggleQuestions(poll)">See less...</a>
        </div>

        <button class="mt-3 px-4 py-2 bg-blue-500 text-white rounded" (click)="submitVotes(poll._id)">Submit
            Vote</button>

        <div class="text-gray-600 mt-4" *ngIf="hasQuestionsWithVotes(poll)">
            <div *ngIf="isUserAnswered(poll)">
                <div *ngIf="!poll.showResults">
                    <a class="text-blue-500 underline cursor-pointer" (click)="toggleResults(poll)">See results...</a>
                </div>

                <div *ngIf="poll.showResults">
                    <h4 class="font-semibold">Results:</h4>
                    <div *ngFor="let question of poll.questions; let qIndex = index">
                        <p><strong>{{ question.question }}</strong></p>
                        <p>Correct Votes: {{ question.correctVotes }}</p>
                        <p>Total Votes: {{ question.totalVotes }}</p>
                        <p>Correct Answer: {{ question.options[question.correctAnswerIndex] }}</p>
                        <p>
                            Percentage of Correct Votes:
                            {{ getPercentage(question.correctVotes, question.totalVotes) | number: '1.0-2' }}%
                        </p>
                    </div>
                    <a class="text-blue-500 underline cursor-pointer" (click)="toggleResults(poll)">Hide results...</a>
                </div>
            </div>
        </div>
    </div>
</div>